<!-- Enhanced Admin Dashboard -->
<div class="admin-dashboard">
  <div class="dashboard-container">
    
    <!-- Dashboard Header -->
    <div class="dashboard-header glass-card">
      <div class="header-content">
        <div class="header-title">
          <div class="admin-icon">ğŸ‘‘</div>
          <div>
            <h1>{{ 'admin.dashboard.title' | translate }}</h1>
            <p class="header-subtitle">{{ 'admin.dashboard.subtitle' | translate }}</p>
          </div>
        </div>
        <div class="header-actions">
          <button (click)="loadStats()" class="glass-btn">
            ğŸ”„ {{ 'admin.dashboard.refreshData' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <nav class="admin-nav glass-card">
      <button 
        *ngFor="let tab of ['dashboard', 'guests', 'listings', 'listings-pending', 'bookings', 'revenue', 'promotions']"
        [class.active]="activeTab === tab"
        (click)="onTabChange(tab)"
        class="nav-btn">
        <span>{{ getTabLabel(tab) | translate }}</span>
      </button>
    </nav>

    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loading-spinner glass-card">
      <div class="spinner"></div>
      <p>{{ 'admin.dashboard.loading' | translate }}</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-box glass-card">
      <div>
        <strong>âš ï¸ {{ 'common.error' | translate }}:</strong>
        <span>{{ errorMessage }}</span>
      </div>
      <button (click)="errorMessage = null" class="close-btn">{{ 'admin.dashboard.dismiss' | translate }}</button>
    </div>

    <!-- Dashboard Overview Tab -->
    <div *ngIf="activeTab === 'dashboard' && stats && !isLoading" class="tab-content">
      <div class="stats-grid">
        <div class="stat-card glass-card">
          <div class="stat-header">
            <div>
              <h3>{{ 'admin.stats.totalGuests' | translate }}</h3>
            </div>
            <div class="stat-icon">ğŸ‘¥</div>
          </div>
          <p class="stat-number">{{ stats.totalUsers }}</p>
          <p class="stat-subtitle">
            <span class="stat-trend up">â†‘ 12%</span>
            {{ 'admin.stats.activeUsers' | translate }}
          </p>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-header">
            <div>
              <h3>{{ 'admin.stats.totalHosts' | translate }}</h3>
            </div>
            <div class="stat-icon">ğŸ </div>
          </div>
          <p class="stat-number">{{ stats.totalHosts || stats.totalUsers }}</p>
            <p class="stat-subtitle">
            <span class="stat-trend up">â†‘ 8%</span>
            {{ 'admin.stats.propertyOwners' | translate }}
          </p>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-header">
            <div>
              <h3>{{ 'admin.stats.totalListings' | translate }}</h3>
            </div>
            <div class="stat-icon">ğŸ¢</div>
          </div>
          <p class="stat-number">{{ stats.totalListings }}</p>
            <p class="stat-subtitle">
            <span class="stat-trend up">â†‘ 15%</span>
            {{ 'admin.stats.propertiesListed' | translate }}
          </p>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-header">
            <div>
              <h3>{{ 'admin.stats.totalBookings' | translate }}</h3>
            </div>
            <div class="stat-icon">ğŸ“…</div>
          </div>
          <p class="stat-number">{{ stats.totalBookings }}</p>
            <p class="stat-subtitle">
            <span class="stat-trend up">â†‘ 22%</span>
            {{ 'admin.stats.reservationsMade' | translate }}
          </p>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-header">
            <div>
              <h3>{{ 'admin.stats.pendingApprovals' | translate }}</h3>
            </div>
            <div class="stat-icon">â³</div>
          </div>
          <p class="stat-number">{{ stats.pendingListingsCount }}</p>
            <p class="stat-subtitle">
            {{ 'admin.stats.awaitingReview' | translate }}
          </p>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-header">
            <div>
              <h3>{{ 'admin.stats.activePromotions' | translate }}</h3>
            </div>
            <div class="stat-icon">ğŸ¯</div>
          </div>
          <p class="stat-number">{{ stats.activePromotionsCount }}</p>
            <p class="stat-subtitle">
            {{ 'admin.stats.currentlyRunning' | translate }}
          </p>
        </div>
      </div>
    </div>

    <!-- Guests Management Tab -->
    <div *ngIf="activeTab === 'guests' && !isLoading" class="tab-content">
      
      <!-- Filter Section -->
      <div class="filter-section glass-card">
        <div class="filter-controls">
          <div class="filter-group">
            <label>ğŸ” {{ 'admin.guests.searchByEmail' | translate }}</label>
            <input 
              [(ngModel)]="userSearchQuery"
              placeholder="{{ 'admin.guests.searchPlaceholder' | translate }}"
              class="form-input" 
              (keyup.enter)="searchUsers()" />
          </div>
          
          <div class="filter-group">
            <label>ğŸ‘¤ {{ 'admin.guests.filterByRole' | translate }}</label>
            <select [(ngModel)]="userRoleFilter" class="form-select">
              <option value="">{{ 'admin.guests.allRoles' | translate }}</option>
              <option value="Guest">{{ 'admin.guests.guest' | translate }}</option>
              <option value="Host">{{ 'admin.guests.host' | translate }}</option>
              <option value="Admin">{{ 'admin.guests.admin' | translate }}</option>
            </select>
          </div>

          <div class="filter-group">
            <label>âœ… {{ 'admin.guests.status' | translate }}</label>
            <select [(ngModel)]="userActiveFilter" class="form-select">
              <option [ngValue]="null">All</option>
              <option [ngValue]="true">{{ 'admin.guests.active' | translate }}</option>
              <option [ngValue]="false">{{ 'admin.guests.inactive' | translate }}</option>
            </select>
          </div>

          <div class="filter-group">
            <label>&nbsp;</label>
            <button (click)="searchUsers()" class="glass-btn primary">{{ 'admin.guests.applyFilters' | translate }}</button>
          </div>
        </div>
      </div>

      <!-- Users Table -->
      <div class="table-container glass-card">
        <table class="data-table">
          <thead>
            <tr>
              <th>{{ 'admin.guests.id' | translate }}</th>
              <th>{{ 'admin.guests.email' | translate }}</th>
              <th>{{ 'admin.guests.fullName' | translate }}</th>
              <th>{{ 'admin.guests.role' | translate }}</th>
              <th>{{ 'admin.guests.bookings' | translate }}</th>
              <th>{{ 'admin.guests.status' | translate }}</th>
              <th>{{ 'admin.guests.actions' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.id.slice(0, 8) }}...</td>
              <td>{{ user.email }}</td>
              <td>{{ user.fullName }}</td>
              <td><span class="badge">{{ user.role }}</span></td>
              <td>{{ user.bookingsCount || 0 }}</td>
              <td>
                <span [class]="user.isActive ? 'status-active' : 'status-inactive'">
                  {{ user.isActive ? ('admin.guests.active' | translate) : ('admin.guests.inactive' | translate) }}
                </span>
              </td>
              <!-- <td>{{ user.createdAt | date:'short' }}</td> -->
              <td>
                <button 
                  *ngIf="user.isActive"
                  (click)="deactivateUser(user.id)"
                  class="glass-btn btn-danger btn-sm">
                  {{ 'admin.guests.deactivate' | translate }}
                </button>
                <button 
                  *ngIf="!user.isActive"
                  (click)="deactivateUser(user.id)"
                  class="glass-btn btn-success btn-sm">
                  {{ 'admin.guests.activate' | translate }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="users.length === 0" class="empty-message">
          {{ 'admin.guests.noUsers' | translate }}
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination glass-card">
        <button (click)="previousPage('users')" [disabled]="usersPage === 1" class="glass-btn">
          â† {{ 'admin.pagination.previous' | translate }}
        </button>
        <span>{{ 'admin.guests.page' | translate }} {{ usersPage }}</span>
        <button (click)="nextPage('users')" [disabled]="users.length < usersPageSize" class="glass-btn">
          {{ 'admin.pagination.next' | translate }} â†’
        </button>
      </div>
    </div>

    <!-- All Listings Tab -->
    <div *ngIf="activeTab === 'listings' && !isLoading" class="tab-content">
      
      <!-- Filter Section -->
      <div class="filter-section glass-card">
        <div class="filter-controls">
          <div class="filter-group">
            <label>ğŸ·ï¸ {{ 'admin.listings.filterByStatus' | translate }}</label>
            <select [(ngModel)]="listingStatusFilter" class="form-select">
              <option value="">{{ 'admin.listings.allStatuses' | translate }}</option>
              <option value="approved">{{ 'admin.listings.approved' | translate }}</option>
              <option value="pending">{{ 'admin.listings.pending' | translate }}</option>
              <option value="rejected">{{ 'admin.listings.rejected' | translate }}</option>
              <option value="promoted">{{ 'admin.listings.promoted' | translate }}</option>
            </select>
          </div>

          <div class="filter-group">
            <label>&nbsp;</label>
            <button (click)="filterListings()" class="glass-btn primary">{{ 'admin.listings.applyFilter' | translate }}</button>
          </div>
        </div>
      </div>

      <!-- Listings Table -->
      <div class="table-container glass-card">
        <table class="data-table">
          <thead>
            <tr>
              <th>{{ 'admin.listings.id' | translate }}</th>
              <th>{{ 'admin.listings.title' | translate }}</th>
              <th>{{ 'admin.listings.location' | translate }}</th>
              <th>{{ 'admin.listings.pricePerNight' | translate }}</th>
              <th>{{ 'admin.listings.host' | translate }}</th>
              <th>{{ 'admin.listings.status' | translate }}</th>
              <th>{{ 'admin.listings.promotion' | translate }}</th>
              <th>{{ 'admin.listings.reviews' | translate }}</th>
              <th>{{ 'admin.listings.actions' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let listing of listings">
              <td>#{{ listing.id }}</td>
              <td>{{ listing.title }}</td>
              <td>ğŸ“ {{ listing.location }}</td>
              <td>{{ listing.pricePerNight | number:'1.0-2' }} EGP</td>
              <td>{{ listing.hostName }}</td>
              <td>
                <span [ngClass]="{
                  'status-approved': listing.status === 'approved',
                  'status-pending': listing.status === 'pending',
                  'status-rejected': listing.status === 'rejected',
                  'status-promoted': listing.status === 'promoted'
                }">
                  {{ ('admin.listings.' + (listing.status || 'unknown')) | translate }}
                </span>
              </td>
              <td>
                <span *ngIf="listing.isPromoted && listing.promotionEndDate" class="promotion-badge">
                  ğŸ¯ {{ 'admin.listings.until' | translate }} {{ listing.promotionEndDate | date:'short' }}
                </span>
                <span *ngIf="!listing.isPromoted" class="text-muted">â€”</span>
              </td>
              <td>â­ {{ listing.reviewsCount || 0 }}</td>
              <td class="actions-cell">
                <div class="action-buttons">
                <button 
                  *ngIf="listing.status === 'pending'"
                  (click)="approveListing(listing.id)"
                  class="glass-btn btn-success btn-xs">
                  âœ“ {{ 'admin.listings.approve' | translate }}
                </button>
                <button 
                  *ngIf="listing.status === 'pending'"
                  (click)="rejectListing(listing.id)"
                  class="glass-btn btn-danger btn-xs">
                  âœ— {{ 'admin.listings.reject' | translate }}
                </button>

                <!-- Show Reject for already approved listings -->
                <button
                  *ngIf="listing.status === 'approved'"
                  (click)="rejectListing(listing.id)"
                  class="glass-btn btn-danger btn-xs">
                  âœ— {{ 'admin.listings.reject' | translate }}
                </button>

                <!-- Show Approve for rejected listings -->
                <button
                  *ngIf="listing.status === 'rejected'"
                  (click)="approveListing(listing.id)"
                  class="glass-btn btn-success btn-xs">
                  âœ“ {{ 'admin.listings.approve' | translate }}
                </button>

                <button 
                  *ngIf="listing.status === 'approved' && !listing.isPromoted"
                  (click)="promoteListing(listing.id)"
                  class="glass-btn btn-info btn-xs">
                  ğŸ“ˆ {{ 'admin.listings.promote' | translate }}
                </button>
                <button 
                  *ngIf="listing.isPromoted"
                  (click)="unpromoteListing(listing.id)"
                  class="glass-btn btn-warning btn-xs">
                  {{ 'admin.listings.stopPromo' | translate }}
                </button>
                <button 
                  *ngIf="listing.isPromoted"
                  (click)="extendPromotion(listing.id)"
                  class="glass-btn btn-info btn-xs">
                  ğŸ”„ {{ 'admin.listings.extend' | translate }}
                </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="listings.length === 0" class="empty-message">
          {{ 'admin.listings.noListings' | translate }}
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination glass-card">
        <button (click)="previousPage('listings')" [disabled]="listingsPage === 1" class="glass-btn">
          â† {{ 'admin.pagination.previous' | translate }}
        </button>
        <span>{{ 'admin.listings.page' | translate }} {{ listingsPage }}</span>
        <button (click)="nextPage('listings')" [disabled]="listings.length < listingsPageSize" class="glass-btn">
          {{ 'admin.pagination.next' | translate }} â†’
        </button>
      </div>
    </div>

    <!-- Pending Listings Tab -->
    <div *ngIf="activeTab === 'listings-pending' && !isLoading" class="tab-content">
      <h2>ğŸ“‹ {{ 'admin.listings.pendingApproval' | translate }}</h2>
      <div class="table-container glass-card">
        <table class="data-table">
          <thead>
              <tr>
              <th>{{ 'admin.listings.id' | translate }}</th>
              <th>{{ 'admin.listings.title' | translate }}</th>
              <th>{{ 'admin.listings.location' | translate }}</th>
              <th>{{ 'admin.listings.pricePerNight' | translate }}</th>
              <th>{{ 'admin.listings.host' | translate }}</th>
              <th>{{ 'admin.listings.submitted' | translate }}</th>
              <th>{{ 'admin.listings.actions' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let listing of pendingListings">
              <td>#{{ listing.id }}</td>
              <td>{{ listing.title }}</td>
              <td>ğŸ“ {{ listing.location }}</td>
              <td>{{ listing.pricePerNight | number:'1.0-2' }} EGP</td>
              <td>{{ listing.hostName }}</td>
              <td>{{ listing.createdAt | date:'short' }}</td>
              <td class="actions-cell">
                <button (click)="approveListing(listing.id)" class="glass-btn btn-success btn-xs">
                  âœ“ {{ 'admin.listings.approve' | translate }}
                </button>
                <button (click)="rejectListing(listing.id)" class="glass-btn btn-danger btn-xs">
                  âœ— {{ 'admin.listings.reject' | translate }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="pendingListings.length === 0" class="empty-message">
          {{ 'admin.listings.noListings' | translate }}
        </div>
      </div>
    </div>

    <!-- Bookings Tab -->
    <div *ngIf="activeTab === 'bookings' && !isLoading" class="tab-content">
      <h2>ğŸ“… {{ 'admin.bookings.title' | translate }}</h2>
      <div class="table-container glass-card">
        <table class="data-table">
          <thead>
            <tr>
              <th>{{ 'admin.bookings.id' | translate }}</th>
              <th>{{ 'admin.bookings.listing' | translate }}</th>
              <th>{{ 'admin.bookings.guest' | translate }}</th>
              <th>{{ 'admin.bookings.host' | translate }}</th>
              <th>{{ 'admin.bookings.checkIn' | translate }}</th>
              <th>{{ 'admin.bookings.checkOut' | translate }}</th>
              <th>{{ 'admin.bookings.totalPrice' | translate }}</th>
              <th>{{ 'admin.bookings.status' | translate }}</th>
              <th>{{ 'admin.bookings.payment' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let booking of bookings">
              <td>#{{ booking.id }}</td>
              <td>{{ booking.listingTitle }}</td>
              <td>{{ booking.guestName }}</td>
              <td>{{ booking.hostName }}</td>
              <td>{{ booking.checkIn | date:'short' }}</td>
              <td>{{ booking.checkOut | date:'short' }}</td>
              <td>{{ booking.totalPrice | number:'1.0-2' }} EGP</td>
              <td>
                <span [ngClass]="{
                  'status-confirmed': booking.bookingStatus === 'confirmed',
                  'status-pending': booking.bookingStatus === 'pending',
                  'status-cancelled': booking.bookingStatus === 'cancelled'
                }">
                  {{ translateBookingStatus(booking.bookingStatus) }}
                </span>
              </td>
              <td>
                <span [ngClass]="{
                  'status-paid': booking.paymentStatus === 'paid',
                  'status-pending': booking.paymentStatus === 'pending',
                  'status-failed': booking.paymentStatus === 'failed'
                }">
                  {{ translateBookingStatus(booking.paymentStatus) }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="bookings.length === 0" class="empty-message">
          {{ 'admin.bookings.noBookings' | translate }}
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination glass-card">
        <button (click)="previousPage('bookings')" [disabled]="bookingsPage === 1" class="glass-btn">
          â† {{ 'admin.pagination.previous' | translate }}
        </button>
        <span>{{ 'admin.bookings.page' | translate }} {{ bookingsPage }}</span>
        <button (click)="nextPage('bookings')" [disabled]="bookings.length < bookingsPageSize" class="glass-btn">
          {{ 'admin.pagination.next' | translate }} â†’
        </button>
      </div>
    </div>

    <!-- Revenue Tab -->
    <div *ngIf="activeTab === 'revenue' && !isLoading" class="tab-content">
      <h2>ğŸ’° {{ 'admin.revenue.title' | translate }}</h2>
      
      <!-- Revenue Summary -->
      <div class="revenue-summary glass-card">
        <div class="revenue-card">
          <h3>{{ 'admin.revenue.totalRevenue' | translate }} ({{ revenueMonths }} {{ 'admin.revenue.months' | translate }})</h3>
          <p class="revenue-number">{{ getTotalRevenue() | number:'1.0-2' }} EGP</p>
        </div>
        <div class="revenue-card">
          <h3>{{ 'admin.revenue.averageMonthly' | translate }}</h3>
          <p class="revenue-number">{{ (getTotalRevenue() / revenueMonths) | number:'1.0-2' }} EGP</p>
        </div>
      </div>

      <!-- Revenue Table -->
      <div class="table-container glass-card">
        <table class="data-table">
          <thead>
            <tr>
              <th>{{ 'admin.revenue.month' | translate }}</th>
              <th>{{ 'admin.revenue.totalRevenue' | translate }}</th>
              <th>{{ 'admin.revenue.transactions' | translate }}</th>
              <th>{{ 'admin.revenue.averagePerTransaction' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let point of revenueData">
              <td>{{ point.monthDate | date:'MMM yyyy' }}</td>
              <td>{{ point.total | number:'1.0-2' }} EGP</td>
              <td>{{ point.transactionCount || 0 }}</td>
              <td>{{ ((point.transactionCount || 0) > 0 ? point.total / (point.transactionCount || 1) : 0) | number:'1.0-2' }} EGP</td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="revenueData.length === 0" class="empty-message">
          {{ 'admin.revenue.noData' | translate }}
        </div>
      </div>
    </div>

    <!-- Promotions Tab -->
    <div *ngIf="activeTab === 'promotions' && !isLoading" class="tab-content">
      <h2>ğŸ¯ {{ 'admin.promotions.title' | translate }}</h2>

      <!-- Active Promotions Section -->
      <div class="promotion-section">
        <h3>ğŸ”´ {{ 'admin.promotions.active' | translate }} ({{ activePromotions.length }})</h3>
        <div class="table-container glass-card">
          <table class="data-table">
            <thead>
              <tr>
                <th>{{ 'admin.promotions.listing' | translate }}</th>
                <th>{{ 'admin.promotions.host' | translate }}</th>
                <th>{{ 'admin.promotions.startDate' | translate }}</th>
                <th>{{ 'admin.promotions.endDate' | translate }}</th>
                <th>{{ 'admin.promotions.daysRemaining' | translate }}</th>
                <th>{{ 'admin.promotions.actions' | translate }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let promo of activePromotions">
                <td>{{ promo.listingTitle }}</td>
                <td>{{ promo.hostName }}</td>
                <td>{{ promo.startDate | date:'short' }}</td>
                <td>{{ promo.endDate | date:'short' }}</td>
                <td>
                  <span [class]="getDaysRemainingClass(promo.endDate)">
                    {{ getDaysRemaining(promo.endDate) }} {{ 'admin.promotions.days' | translate }}
                  </span>
                </td>
                <td>
                  <button (click)="extendPromotion(promo.listingId)" class="glass-btn btn-info btn-xs">
                    ğŸ”„ {{ 'admin.promotions.extend' | translate }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="activePromotions.length === 0" class="empty-message">
            {{ 'admin.promotions.noActive' | translate }}
          </div>
        </div>
      </div>

      <!-- Expiring Soon Section -->
      <div class="promotion-section">
        <h3>âš ï¸ {{ 'admin.promotions.expiringSoon' | translate }} - {{ expiringPromotions.length }}</h3>
        <div class="table-container glass-card">
          <table class="data-table">
            <thead>
              <tr>
                <th>Listing</th>
                <th>Host</th>
                <th>Expires In</th>
                <th>End Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let promo of expiringPromotions">
                <td>{{ promo.listingTitle }}</td>
                <td>{{ promo.hostName }}</td>
                <td>
                  <span class="expiry-warning">
                    {{ getDaysRemaining(promo.endDate) }} {{ 'admin.promotions.days' | translate }}
                  </span>
                </td>
                <td>{{ promo.endDate | date:'short' }}</td>
                <td>
                  <button (click)="extendPromotion(promo.listingId)" class="glass-btn btn-info btn-xs">
                    ğŸ”„ {{ 'admin.promotions.extend' | translate }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="expiringPromotions.length === 0" class="empty-message">
            {{ 'admin.promotions.noExpiring' | translate }}
          </div>
        </div>
      </div>

      <!-- Promotion History Section -->
      <div class="promotion-section">
        <h3>ğŸ“‹ {{ 'admin.promotions.history' | translate }}</h3>
        <div class="table-container glass-card">
          <table class="data-table">
            <thead>
              <tr>
                <th>Listing</th>
                <th>Host</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Duration</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let promo of promotionHistory">
                <td>{{ promo.listingTitle }}</td>
                <td>{{ promo.hostName }}</td>
                <td>{{ promo.startDate | date:'short' }}</td>
                <td>{{ promo.endDate | date:'short' }}</td>
                <td>{{ getDaysBetween(promo.startDate, promo.endDate) }} {{ 'admin.promotions.days' | translate }}</td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="promotionHistory.length === 0" class="empty-message">
            {{ 'admin.promotions.noHistory' | translate }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>