<div class="container mt-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 mybookings-header">
    <h2 class="mb-0">
      <i class="bi bi-journal-bookmark-fill text-primary me-2"></i>
      My Bookings
    </h2>

    <button 
      class="btn btn-outline-primary"
      (click)="loadMyBookings()"
      [disabled]="isLoading()">
      <i class="bi bi-arrow-clockwise"></i> Refresh
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading()" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-3 text-muted">Loading your bookings...</p>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage() && !isLoading()" class="alert alert-danger">
    {{ errorMessage() }}
  </div>

  <!-- Empty State -->
  <div 
    *ngIf="!isLoading() && !errorMessage() && bookings().length === 0"
    class="text-center py-5">

    <i class="bi bi-calendar-x empty-icon"></i>
    <h4 class="mt-3">No bookings yet</h4>
    <p class="text-muted">Start exploring and make your first booking!</p>

    <a routerLink="/listings" class="btn btn-primary btn-lg">Browse Listings</a>
  </div>

  <!-- Booking Cards -->
  <div *ngIf="!isLoading() && bookings().length > 0" class="row">
    <div *ngFor="let booking of bookings()" class="col-md-6 mb-4">
      <div class="card h-100">

        <!-- Header -->
        <div class="card-header d-flex justify-content-between align-items-center">
          <span 
            class="badge"
            [ngClass]="getStatusBadgeClass(booking.bookingStatus)">
            {{ booking.bookingStatus }}
          </span>

          <span 
            class="badge"
            [ngClass]="getPaymentBadgeClass(booking.paymentStatus)">
            {{ booking.paymentStatus }}
          </span>
        </div>

        <!-- Body -->
        <div class="card-body">
          <h5 class="card-title mb-3">
            Booking #{{ booking.id }}
          </h5>

          <p class="mb-2">
            <strong>Dates:</strong><br>
            {{ booking.checkInDate | date:'mediumDate' }}
            -
            {{ booking.checkOutDate | date:'mediumDate' }}
          </p>

          <p class="mb-2">
            <strong>Total Price:</strong>
            EGP {{ booking.totalPrice }}
          </p>

          <p class="mb-0">
            <strong>Listing:</strong>
            {{ booking.listingId }}
          </p>

          <!-- Payment Warning for Failed/Pending Payments -->
          <div *ngIf="canRetryPayment(booking)" class="alert alert-warning mt-3 mb-0">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <small>
              <strong>Payment Required:</strong> 
              Your booking is pending payment completion.
            </small>
          </div>
        </div>

        <!-- Footer -->
        <div class="card-footer bg-white">
          <div class="d-flex gap-2 flex-wrap">
            
            <!-- Continue to Pay Button (Only for pending/failed payments) -->
            <button 
              *ngIf="canRetryPayment(booking)"
              class="btn btn-success btn-sm flex-fill"
              (click)="continueToPayment(booking)"
              [disabled]="isProcessing(booking.id)">
              <i class="bi bi-credit-card me-1"></i>
              {{ isProcessing(booking.id) ? 'Processing...' : 'Continue to Pay' }}
            </button>

            <!-- View Listing Button -->
            <a 
              [routerLink]="['/listings', booking.listingId]"
              class="btn btn-outline-primary btn-sm"
              [class.flex-fill]="!canRetryPayment(booking)">
              <i class="bi bi-eye me-1"></i>
              View Listing
            </a>

            <!-- Cancel Button (Only for non-cancelled bookings) -->
            <button 
              *ngIf="booking.bookingStatus.toLowerCase() !== 'cancelled'"
              class="btn btn-outline-danger btn-sm"
              (click)="cancelBooking(booking.id)"
              [disabled]="booking.bookingStatus === 'cancelled'">
              <i class="bi bi-x-circle me-1"></i>
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>