<div class="broker-detail-container">

  <!-- Loading State -->
  <div *ngIf="loading" class="broker-loading-section">
    <div class="broker-character-container">
      <img src="/3.png" alt="The Broker Character" class="loading-character" />
      <div class="loading-accent-circle"></div>
    </div>
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h3>{{ 'listings.loadingProperty' | translate }}</h3>
      <p>{{ 'listings.preparingDetails' | translate }}</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="broker-error-section">
    <div class="broker-character-container">
      <img src="/3.png" alt="The Broker Character" class="error-character" />
      <div class="error-accent-circle"></div>
    </div>
    <div class="error-content">
      <i class="bi bi-exclamation-triangle"></i>
      <h3>{{ 'listings.errorOccurred' | translate }}</h3>
      <p>{{ error }}</p>
      <button class="btn-broker" (click)="goBack()">
        <i class="bi bi-arrow-left"></i>
        {{ 'listings.backToListings' | translate }}
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="listing && !loading && !error" class="broker-detail-content">

    <!-- Hero Section with Character -->
    <div class="broker-detail-hero">
      <div class="container-fluid">
        <div class="row align-items-center">
          <!-- Character Section -->
          <div class="col-md-3 d-flex justify-content-center">
            <div class="broker-character-container">
              <img src="/3.png" alt="The Broker Character" class="detail-character" />
              <div class="detail-accent-circle"></div>
            </div>
          </div>

          <!-- Property Header Section -->
          <div class="col-md-9">
            <div class="broker-property-header">
              <!-- Navigation -->
              <nav class="property-breadcrumb">
                <a [routerLink]="['/listings']" class="breadcrumb-link">
                  <i class="bi bi-house-door"></i>
                  {{ 'listings.allProperties' | translate }}
                </a>
                <i class="bi bi-chevron-right"></i>
                <span class="current-page">{{ listing.title }}</span>
              </nav>

              <!-- Property Title & Status -->
              <div class="property-title-section">
                <h1 class="property-title">{{ listing.title }}</h1>
                <div class="property-status" [class.approved]="listing.isApproved" [class.pending]="!listing.isApproved">
                  <i class="bi" [class.bi-check-circle-fill]="listing.isApproved" [class.bi-clock-fill]="!listing.isApproved"></i>
                  {{ listing.isApproved ? ('listings.approved' | translate) : ('listings.pending' | translate) }}
                </div>
              </div>

              <!-- Property Meta Info -->
              <div class="property-meta">
                <div class="meta-item location">
                  <i class="bi bi-geo-alt-fill"></i>
                  <span>{{ listing.location }}</span>
                </div>
                <div class="meta-item rating" *ngIf="listing.averageRating">
                  <i class="bi bi-star-fill"></i>
                  <span>{{ listing.averageRating.toFixed(1) }} ({{ listing.reviewCount }} {{ 'listings.reviews' | translate }})</span>
                </div>
                <div class="meta-item rating" *ngIf="!listing.averageRating">
                  <i class="bi bi-star"></i>
                  <span>{{ 'listings.noReviewsYet' | translate }}</span>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class="quick-actions">
                <button class="btn-broker-primary" [routerLink]="['/booking/create', listing.id]">
                  <i class="bi bi-calendar-check"></i>
                  {{ 'listings.bookNow' | translate }}
                </button>
                <button class="btn-broker-outline" (click)="editListing()" *ngIf="canEdit">
                  <i class="bi bi-pencil"></i>
                  {{ 'listings.edit' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Property Showcase Section -->
    <div class="broker-showcase-section">
      <div class="container-fluid">
        <div class="row">

          <!-- Image Gallery -->
          <div class="col-lg-8">
            <div class="broker-image-gallery">

              <!-- Main Image Display -->
              <div class="main-image-container">
                <img [src]="listing.images && listing.images.length > 0
                    ? listing.images[currentImageIndex].imageUrl
                    : '/assets/images/placeholder-listing.jpg'"
                     [alt]="listing.title"
                     class="main-property-image" />

                <!-- Image Navigation -->
                <button *ngIf="listing.images && listing.images.length > 1"
                        class="image-nav-btn prev"
                        (click)="prevImage()">
                  <i class="bi bi-chevron-left"></i>
                </button>
                <button *ngIf="listing.images && listing.images.length > 1"
                        class="image-nav-btn next"
                        (click)="nextImage()">
                  <i class="bi bi-chevron-right"></i>
                </button>

                <!-- Image Counter -->
                <div class="image-counter" *ngIf="listing.images && listing.images.length > 1">
                  {{ currentImageIndex + 1 }} / {{ listing.images.length }}
                </div>
              </div>

              <!-- Thumbnails -->
              <div class="image-thumbnails" *ngIf="listing.images && listing.images.length > 1">
                <button *ngFor="let img of listing.images; let i = index"
                        class="thumbnail-btn"
                        [class.active]="i === currentImageIndex"
                        (click)="selectImage(i)">
                  <img [src]="img.imageUrl" [alt]="'Image ' + (i + 1)" class="thumbnail-image" />
                </button>
              </div>
            </div>
          </div>

          <!-- Property Details -->
          <div class="col-lg-4">
            <div class="broker-property-details">

              <!-- Price Section -->
              <div class="price-section">
                <div class="price-main">
                  <span class="price-amount">{{ listing.pricePerNight }}</span>
                  <span class="price-currency">{{ 'listings.egp' | translate }}</span>
                </div>
                <div class="price-period">{{ 'listings.perNight' | translate }}</div>
              </div>

              <!-- Property Features -->
              <div class="features-grid">
                <div class="feature-item">
                  <i class="bi bi-house-door"></i>
                  <div class="feature-content">
                    <span class="feature-label">{{ 'listings.propertyType' | translate }}</span>
                    <span class="feature-value">{{ listing.type }}</span>
                  </div>
                </div>
                <div class="feature-item">
                  <i class="bi bi-geo-alt"></i>
                  <div class="feature-content">
                    <span class="feature-label">{{ 'listings.destination' | translate }}</span>
                    <span class="feature-value">{{ listing.destination }}</span>
                  </div>
                </div>
                <div class="feature-item">
                  <i class="bi bi-bed"></i>
                  <div class="feature-content">
                    <span class="feature-label">{{ 'listings.bedrooms' | translate }}</span>
                    <span class="feature-value">{{ listing.bedrooms || 'N/A' }}</span>
                  </div>
                </div>
                <div class="feature-item">
                  <i class="bi bi-droplet"></i>
                  <div class="feature-content">
                    <span class="feature-label">{{ 'listings.bathrooms' | translate }}</span>
                    <span class="feature-value">{{ listing.bathrooms || 'N/A' }}</span>
                  </div>
                </div>
                <div class="feature-item">
                  <i class="bi bi-people"></i>
                  <div class="feature-content">
                    <span class="feature-label">{{ 'listings.maxGuests' | translate }}</span>
                    <span class="feature-value">{{ listing.maxGuests }}</span>
                  </div>
                </div>
              </div>

              <!-- Main Action Button -->
              <button class="btn-broker-book" [routerLink]="['/booking/create', listing.id]">
                <i class="bi bi-calendar-check"></i>
                <span>{{ 'listings.bookThisProperty' | translate }}</span>
              </button>

            </div>
          </div>
          <div class="detail-badge">
            <i class="bi bi-droplet-half"></i>
            <span>{{ listing.bathrooms || 'N/A' }} Bathrooms</span>
          </div>
        </div>

        </div>
      </div>
    </div>

    <!-- Property Description & Amenities -->
    <div class="broker-content-section">
      <div class="container-fluid">
        <div class="row">

          <!-- Description -->
          <div class="col-lg-8">
            <div class="broker-description-card">
              <div class="section-header">
                <h3>{{ 'listings.aboutProperty' | translate }}</h3>
                <i class="bi bi-house-heart"></i>
              </div>
              <div class="description-content">
                <p>{{ listing.description }}</p>
              </div>
            </div>

            <!-- Amenities -->
            <div class="broker-amenities-card" *ngIf="listing.amenities && listing.amenities.length > 0">
              <div class="section-header">
                <h3>{{ 'listings.amenities' | translate }}</h3>
                <i class="bi bi-check2-all"></i>
              </div>
              <div class="amenities-grid">
                <div class="amenity-item" *ngFor="let amenity of listing.amenities">
                  <i class="bi bi-check-circle-fill"></i>
                  <span>{{ amenity }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Info Sidebar -->
          <div class="col-lg-4">
            <div class="broker-info-sidebar">

              <!-- Host Information -->
              <div class="host-section">
                <div class="section-header">
                  <h4>{{ 'listings.hostedBy' | translate }}</h4>
                  <i class="bi bi-person-badge"></i>
                </div>
                <div class="host-info">
                  <div class="host-avatar">
                    <i class="bi bi-person-circle"></i>
                  </div>
                  <div class="host-details">
                    <h5>{{ 'listings.hostName' | translate }}</h5>
                    <p>{{ 'listings.verifiedHost' | translate }}</p>
                  </div>
                </div>
              </div>

              <!-- Safety Features -->
              <div class="safety-section">
                <div class="section-header">
                  <h4>{{ 'listings.safetyFeatures' | translate }}</h4>
                  <i class="bi bi-shield-check"></i>
                </div>
                <div class="safety-list">
                  <div class="safety-item">
                    <i class="bi bi-check-circle"></i>
                    <span>{{ 'listings.verifiedProperty' | translate }}</span>
                  </div>
                  <div class="safety-item">
                    <i class="bi bi-check-circle"></i>
                    <span>{{ 'listings.secureBooking' | translate }}</span>
                  </div>
                  <div class="safety-item">
                    <i class="bi bi-check-circle"></i>
                    <span>{{ 'listings.customerSupport' | translate }}</span>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>
        <div id="detail-map" class="detail-map mb-4"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Location Section -->
    <div class="broker-location-section">
      <div class="container-fluid">
        <div class="broker-location-card">
          <div class="section-header">
            <h3>
              <i class="bi bi-geo-alt-fill"></i>
              {{ 'listings.location' | translate }}: {{ listing.location }}
            </h3>
            <div class="location-badge">
              <i class="bi bi-map"></i>
              {{ 'listings.viewOnMap' | translate }}
            </div>
          </div>
          <div class="map-container">
            <div id="detail-map" class="detail-map"></div>
          </div>
          <div class="location-description">
            <p>{{ 'listings.locationDescription' | translate }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Actions -->
    <div class="broker-bottom-actions">
      <div class="container-fluid">
        <div class="actions-row">
          <button class="btn-broker-secondary" (click)="goBack()">
            <i class="bi bi-arrow-left"></i>
            {{ 'listings.backToListings' | translate }}
          </button>
          <div class="primary-actions">
            <button class="btn-broker-outline" *ngIf="canEdit" (click)="editListing()">
              <i class="bi bi-pencil"></i>
              {{ 'listings.editProperty' | translate }}
            </button>
            <button class="btn-broker-primary" [routerLink]="['/booking/create', listing.id]">
              <i class="bi bi-calendar-check"></i>
              {{ 'listings.bookNow' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>

      <!-- Rating Breakdown -->
      <div class="rating-breakdown">
        <div class="breakdown-item">
          <span class="rating-label">5 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 75%"></div>
          </div>
          <span class="rating-count">18</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">4 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 16.7%"></div>
          </div>
          <span class="rating-count">4</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">3 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 8.3%"></div>
          </div>
          <span class="rating-count">2</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">2 stars</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 0%"></div>
          </div>
          <span class="rating-count">0</span>
        </div>
        <div class="breakdown-item">
          <span class="rating-label">1 star</span>
          <div class="rating-bar">
            <div class="rating-fill" style="width: 0%"></div>
          </div>
          <span class="rating-count">0</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Form -->
  <div class="review-form-section">
    <h3>Write a Review</h3>
    <form class="review-form">
      <!-- Rating Selection -->
      <div class="form-group">
        <label>Overall Rating</label>
        <div class="rating-selector">
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn active">
            <i class="bi bi-star-fill"></i>
          </button>
          <button type="button" class="star-btn">
            <i class="bi bi-star"></i>
          </button>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button type="submit" class="glass-btn primary">
            <i class="bi bi-send-fill"></i>Submit Review
          </button>
        </div>
      </div>

      <!-- Review Comment -->
      <div class="form-group">
        <label for="comment">Review</label>
        <textarea id="comment" rows="5" placeholder="Share details of your experience at this property..."
          class="glass-input">The property was even better than the photos! The host was very responsive and the location was perfect for exploring the city. Would definitely stay here again.</textarea>
      </div>


    </form>
  </div>

  <!-- Reviews List -->
  <div class="reviews-list">

    <div class="review-cards">
      <!-- Review 1 -->
      <div class="review-card">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">
              S
            </div>
            <div class="reviewer-details">
              <div class="reviewer-name">Sarah Johnson</div>
              <!-- <div class="review-date">March 15, 2024</div> -->
            </div>
          </div>
          <div class="review-rating">
            <div class="star-display">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
            </div>
            <span class="rating-value">5.0</span>
          </div>
        </div>

        <div class="review-content">
          <!-- <h4 class="review-title">Perfect getaway spot!</h4> -->
          <p class="review-comment">Absolutely loved our stay here! The property was clean, modern, and had everything
            we needed. The view from the balcony was breathtaking, especially during sunrise. The host was very
            responsive and provided great local recommendations.</p>
        </div>
      </div>

    <div class="images-section">
      <div class="main-image">
        <img [src]="listing.images && listing.images.length > 0
            ? listing.images[currentImageIndex].imageUrl
            : 'https://via.placeholder.com/800x600?text=No+Image'" [alt]="listing.title" />
        <button *ngIf="listing.images && listing.images.length > 1" class="nav-btn prev" (click)="prevImage()">
          ‚ùÆ
        </button>
        <button *ngIf="listing.images && listing.images.length > 1" class="nav-btn next" (click)="nextImage()">
          ‚ùØ
        </button>
      </div>

      <div *ngIf="listing.images && listing.images.length > 1" class="thumbnails">
        <button *ngFor="let img of listing.images; let i = index" class="thumbnail"
          [class.active]="i === currentImageIndex" (click)="selectImage(i)">
          <img [src]="img.imageUrl" [alt]="'Image ' + (i + 1)" />
        </button>
      </div>
    </div>

    <div class="main-info">
      <div class="info-header">
        <div class="location-rating">
          <p class="location">üìç {{ listing.location }}</p>
          <div class="rating" *ngIf="listing.averageRating">
            <span class="stars">‚≠ê {{ listing.averageRating.toFixed(1) }}</span>
            <span class="count">({{ listing.reviewCount }} reviews)</span>
          </div>
          <div class="no-rating" *ngIf="!listing.averageRating">
            <span>No reviews yet</span>
          </div>
        </div>

        <div class="review-content">
          <p class="review-comment">Very comfortable stay with excellent amenities. The location is convenient with good
            transportation links. The only minor issue was the Wi-Fi speed, but everything else was perfect. Would
            recommend for business travelers.</p>
        </div>
      </div>

      <!-- Review 3 -->
      <div class="review-card">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">
              E
            </div>
            <div class="reviewer-details">
              <div class="reviewer-name">Emma Rodriguez</div>
            </div>
          </div>
          <div class="review-rating">
            <div class="star-display">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star"></i>
              <i class="bi bi-star"></i>
            </div>
            <span class="rating-value">3.0</span>
          </div>
        </div>

        <div class="review-content">
          <p class="review-comment">The property has great potential but there were some maintenance issues during our
            stay. The air conditioning wasn't working properly and some kitchen appliances were outdated. However, the
            host was very apologetic and offered a partial refund.</p>
        </div>
      </div>
    </div>

      <div class="actions">
        <button class="btn btn-primary btn-large" [routerLink]="['/booking/create', listing.id]">
          Book Now
        </button>
        <button class="btn btn-secondary btn-large" (click)="goBack()">
          Back to Listings
        </button>
      </div>
    </div>
  </div>
</div> -->
